{
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.0.1-preview",
  "parameters": {
    "basics": [],
    "steps": [
      {
        "name": "Infrastructure",
        "label": "Infrastructure",
        "subLabel": {
          "preValidation": "Configure the infrastructure required to support Octopus Deploy",
          "postValidation": "Done"
        },
        "bladeTitle": "Octopus Deploy Infrastructure",
        "elements": [
          {
            "name": "VM",
            "type": "Microsoft.Common.Section",
            "label": "Virtual Machine",
            "elements": [
              {
                "name": "OctopusServerVMPublicIP",
                "type": "Microsoft.Network.PublicIpAddressCombo",
                "label": {
                  "publicIpAddress": "Public IP Address",
                  "domainNameLabel": "Domain Name Prefix"
                },
                "toolTip": {
                  "publicIpAddress": "",
                  "domainNameLabel": ""
                },
                "defaultValue": {
                  "publicIpAddressName": "octopus-publicip"
                },
                "constraints": {
                  "required": {
                    "publicIpAddress": true,
                    "domainNameLabel": true
                  }
                },
                "options": {
                  "hideNone": true,
                  "hideDomainNameLabel": false,
                  "hideExisting": true
                }
              },
              {
                "name": "OctopusServerVMAdminUserName",
                "type": "Microsoft.Common.TextBox",
                "label": "Server Administrator User Name",
                "defaultValue": "octoadmin",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter an administrator user name"
                }
              },
              {
                "name": "OctopusServerVMAdminPassword",
                "type": "Microsoft.Compute.CredentialsCombo",
                "label": {
                  "password": "Administrator Password",
                  "confirmPassword": "Confirm password"
                },
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter an administrator password"
                },
                "options": {
                  "hideConfirmation": false
                },
                "osPlatform": "Windows"
              },
              {
                "name": "OctopusServerVMSize",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Virtual Machine Size",
                "toolTip": "",
                "recommendedSizes": [
                  "Standard_D2",
                  "Standard_D3"
                ],
                "constraints": {
                  "allowedSizes": [],
                  "excludedSizes": []
                },
                "osPlatform": "Windows",
                "imageReference": {
                  "publisher": "MicrosoftWindowsServer",
                  "offer": "WindowsServer",
                  "sku": "2012-R2-Datacenter"
                }
              }
            ]
          },
          {
            "name": "Database",
            "type": "Microsoft.Common.Section",
            "label": "Database",
            "elements": [
              {
                "name": "SqlServerAdminUserName",
                "type": "Microsoft.Common.TextBox",
                "label": "SQL Server Administrator User Name",
                "defaultValue": "sqladmin",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter a SQL Server administrator user name"
                }
              },
              {
                "name": "SqlServerAdminPassword",
                "type": "Microsoft.Common.PasswordBox",
                "label": "SQL Server Administrator Password",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter a SQL Server administrator password"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "Octopus",
        "label": "Octopus Deploy",
        "subLabel": {
          "preValidation": "Configure Octopus Deploy",
          "postValidation": "Done"
        },
        "bladeTitle": "Octopus Deploy Configuration",
        "elements": [
          {
            "name": "Credentials",
            "type": "Microsoft.Common.Section",
            "label": "Octopus Deploy Administrator Credentials",
            "elements": [
              {
                "name": "OctopusAdministratorUserName",
                "type": "Microsoft.Common.TextBox",
                "label": "User Name",
                "defaultValue": "admin",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter an Octopus Deploy administrator user name"
                }
              },
              {
                "name": "OctopusAdministratorPassword",
                "type": "Microsoft.Common.PasswordBox",
                "label": "Password",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter an Octopus Deploy administrator password"
                }
              }
            ]
          },
          {
            "name": "License",
            "type": "Microsoft.Common.Section",
            "label": "License Details",
            "elements": [
              {
                "name": "LicenseFullName",
                "type": "Microsoft.Common.TextBox",
                "label": "Full Name",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter your full name"
                }
              },
              {
                "name": "LicenseOrganization",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Name",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter your organization"
                }
              },
              {
                "name": "LicenseEmail",
                "type": "Microsoft.Common.TextBox",
                "label": "Email Address",
                "constraints": {
                  "required": true,
                  "validationMessage": "Please enter your email address"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "octopusDnsName": "[steps('Infrastructure').VM.OctopusServerVMPublicIP.domainNameLabel]",
      "vmAdminUsername": "[steps('Infrastructure').VM.OctopusServerVMAdminUserName]",
      "vmAdminPassword": "[steps('Infrastructure').VM.OctopusServerVMAdminPassword.password]",
      "vmSize": "[steps('Infrastructure').VM.OctopusServerVMSize]",
      "sqlAdminUsername": "[steps('Infrastructure').Database.SqlServerAdminUserName]",
      "sqlAdminPassword": "[steps('Infrastructure').Database.SqlServerAdminPassword]",
      "licenseFullName": "[steps('Octopus').License.LicenseFullName]",
      "licenseOrganisationName": "[steps('Octopus').License.LicenseOrganization]",
      "licenseEmailAddress": "[steps('Octopus').License.LicenseEmail]",
      "octopusAdminUsername": "[steps('Octopus').Credentials.OctopusAdministratorUserName]",
      "octopusAdminPassword": "[steps('Octopus').Credentials.OctopusAdministratorPassword]"
    }
  }
}
